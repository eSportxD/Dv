#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <zip.h>
#include <openssl/aes.h>
#include <inttypes.h>
#include <ctype.h>
#include <curl/curl.h>

struct MemoryStruct {
    char *memory;
    size_t size;
};

static size_t WriteMemoryCallback(void *contents, size_t size, size_t nmemb, void *userp) {
    size_t realsize = size * nmemb;
    struct MemoryStruct *mem = (struct MemoryStruct *)userp;

    char *ptr = (char*)realloc(mem->memory, mem->size + realsize + 1);
    if(ptr == NULL) {
        // out of memory!
        fprintf(stderr, "not enough memory (realloc returned NULL)\n");
        exit(EXIT_FAILURE);
    }

    mem->memory = ptr;
    memcpy(&(mem->memory[mem->size]), contents, realsize);
    mem->size += realsize;
    mem->memory[mem->size] = 0;

    return realsize;
}

int isExpired(char *url) {
    CURL *curl_handle;
    CURLcode res;

    struct MemoryStruct chunk;
    chunk.memory = (char*)malloc(1);  // will be grown as needed by the realloc above
    chunk.size = 0;                  // no data at this point

    curl_global_init(CURL_GLOBAL_ALL);

    // init the curl session
    curl_handle = curl_easy_init();

    if(curl_handle) {
        // specify URL to get
        curl_easy_setopt(curl_handle, CURLOPT_URL, url);

        // send all data to this function
        curl_easy_setopt(curl_handle, CURLOPT_WRITEFUNCTION, WriteMemoryCallback);

        // we pass our 'chunk' struct to the callback function
        curl_easy_setopt(curl_handle, CURLOPT_WRITEDATA, (void *)&chunk);

        // some servers don't like requests that are made without a user-agent field, so we provide one
        curl_easy_setopt(curl_handle, CURLOPT_USERAGENT, "libcurl-agent/1.0");

        // disable SSL verification of the peer and host
        curl_easy_setopt(curl_handle, CURLOPT_SSL_VERIFYPEER, 0L);
        curl_easy_setopt(curl_handle, CURLOPT_SSL_VERIFYHOST, 0L);

        // get it!
        res = curl_easy_perform(curl_handle);

        // check for errors
        if(res != CURLE_OK) {
            fprintf(stderr, "curl_easy_perform() failed: %s\n", curl_easy_strerror(res));
            exit(EXIT_FAILURE);
        } else {
            if(chunk.memory[0] == '1') {
                printf("This is a trial version of the tool "
                       "Send 2 usdt on trc20 address to buy this tool for\n"
                       "one month after sending 2usdt send screenshot of payment "
                       "to @pureclover\n"
                       "Here is the usdt trc20 Address\n"
                       "TEuQNWS4qGkX3ue6ALBChmLUdAaGCF5VH3\n\n"
                );
            } else if(chunk.memory[0] == '0') {
                printf("Trial version Expired\n"
                       "Send 2 usdt on trc20 address to buy this tool for\n"
                       "one month after sending 2usdt send screenshot of payment "
                       "to @pureclover\n"
                       "Here is the usdt trc20 Address\n"
                       "TEuQNWS4qGkX3ue6ALBChmLUdAaGCF5VH3\n\n"
                );
                exit(EXIT_FAILURE);
            } else {
                printf("\r#Something Terrible happened...\n"
                       "\n"
                );
                exit(EXIT_FAILURE);
            }
        }

        // cleanup curl stuff
        curl_easy_cleanup(curl_handle);

        if(chunk.memory)
            free(chunk.memory);
    }

    // we're done with libcurl, so clean it up
    curl_global_cleanup();

    return 0;
}
unsigned char key[16] = {
    0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x76, 0x77,
     0x88, 0x99, 0xaa, 0x55, 0xcc, 0xdd, 0xee, 0xff
 };
unsigned char iv[16] = {
    0xff, 0xee, 0xdd, 0xcc, 0xbb, 0xaa, 0x99, 0x55,
     0x77, 0x66, 0x55, 0x55, 0x33, 0x22, 0x11, 0x00
 };

#define BLOCK_SIZE 16

void encrypt(unsigned char *plaintext, int plaintext_len, unsigned char *key, unsigned char *iv, unsigned char *encrypted_data) {
    AES_KEY aes_key;
    AES_set_encrypt_key(key, 128, &aes_key);
    
    // Add PKCS#7 padding
    int padding_len = BLOCK_SIZE - (plaintext_len % BLOCK_SIZE);
    int padded_len = plaintext_len + padding_len;
    unsigned char *padded_plaintext = (unsigned char *)malloc(padded_len);
    memcpy(padded_plaintext, plaintext, plaintext_len);
    memset(padded_plaintext + plaintext_len, padding_len, padding_len);
    
    AES_cbc_encrypt(padded_plaintext, encrypted_data, padded_len, &aes_key, iv, AES_ENCRYPT);
    
    free(padded_plaintext);
}

void encrypt_string(unsigned char *plain, int plain_len, unsigned char *encrypted_script) {
    for (int i = 0; i < plain_len; i++) {
        encrypted_script[i] = plain[i] ^ 0xAA;
    }
}

unsigned char* encryptTheFileContent(unsigned char *plaintext, int plaintext_len, int *encrypted_len) {
    // printf("[+] : Now encrypting the content using XOR Encryption.\n");
    
    unsigned char *xor_encrypted_data = (unsigned char *)malloc(plaintext_len + 1); // +1 for null-termination
    encrypt_string(plaintext, plaintext_len, xor_encrypted_data);
    xor_encrypted_data[plaintext_len] = '\0'; // Ensure null-termination

    // printf("[+] : Now encrypting the content using AES CBC mode.\n");
    
    int padded_len = plaintext_len + (BLOCK_SIZE - (plaintext_len % BLOCK_SIZE));
    unsigned char *encrypted_data = (unsigned char *)malloc(padded_len + 1); // +1 for null-termination
    encrypt(xor_encrypted_data, plaintext_len, key, iv, encrypted_data);
    
    *encrypted_len = padded_len;
    free(xor_encrypted_data);
    
    return encrypted_data;
}


#define MAX_LINE_LENGTH 1024

// Convert a single hex character to its integer value
int hex_char_to_int(char c) {
    if (c >= '0' && c <= '9') return c - '0';
    if (c >= 'a' && c <= 'f') return c - 'a' + 10;
    if (c >= 'A' && c <= 'F') return c - 'A' + 10;
    return -1;
}

// Convert a hex string to binary data
size_t hex_string_to_binary(const char *hex_string, unsigned char *binary_data) {
    size_t len = 0;
    for (size_t i = 0; hex_string[i] != '\0' && hex_string[i+1] != '\0'; i += 2) {
        int high = hex_char_to_int(hex_string[i]);
        int low = hex_char_to_int(hex_string[i+1]);
        if (high == -1 || low == -1) break;
        binary_data[len++] = (unsigned char)((high << 4) | low);
    }
    return len;
}
// Function to write data into ZIP in memory
static int write_to_zip(zip_t *zip, const char *filename, const unsigned char *data, size_t size) {
    zip_source_t *source = zip_source_buffer(zip, data, size, 0);
    if (source == NULL) {
        fprintf(stderr, "Failed to create zip source\n");
        return -1;
    }
    if (zip_file_add(zip, filename, source, ZIP_FL_OVERWRITE) < 0) {
        fprintf(stderr, "Failed to add file to zip: %s\n", zip_strerror(zip));
        zip_source_free(source);
        return -1;
    }
    return 0;
}
// Function to handle ZIP archive in memory
int create_zip_in_memory(unsigned char **zipBuffer, size_t *zipSize, const unsigned char *encryptedData, size_t encryptedDataSize) {
    zip_error_t error;
    zip_source_t *src;
    zip_t *za;
    void *data = NULL;
    size_t size = 0;

    // Create a new ZIP archive in memory
    src = zip_source_buffer_create(data, size, 1, &error);
    if (!src) {
        fprintf(stderr, "Can't create zip source: %s\n", zip_error_strerror(&error));
        return 1;
    }

    // Open the archive
    za = zip_open_from_source(src, ZIP_CREATE, &error);
    if (!za) {
        fprintf(stderr, "Can't open zip from source: %s\n", zip_error_strerror(&error));
        zip_source_free(src);
        return 1;
    }

    // Example content to add to the ZIP archive
    const char *main_py = 
        "import zipfile\n"
        "import os\n"
        "import shutil\n"
        "import tempfile\n"
        "import sys\n"
        "import platform\n"
        "import subprocess\n\n"
        "def main():\n"
        "    # Create a temporary directory\n"
        "    temp_dir = tempfile.mkdtemp()\n\n"
        "    try:\n"
        "        # Get the path to the current script\n"
        "        zip_file_path = os.path.abspath(sys.argv[0])\n\n"
        "        # Extract the ZIP file to the temporary directory\n"
        "        with zipfile.ZipFile(zip_file_path, 'r') as zip_ref:\n"
        "            zip_ref.extractall(temp_dir)\n\n"
        "        # Determine the system and architecture\n"
        "        system = platform.system()\n"
        "        architecture = platform.machine()\n\n"
        "        # Set the executable name based on platform and architecture\n"
        "        if system == 'Linux':\n"
        "            if architecture in ['aarch64', 'arm64']:\n"
        "                executable_name = 'Executepy_arm64'\n"
        "            else:\n"
        "                raise RuntimeError(f\"Unsupported architecture: {architecture}\")\n"
        "        else:\n"
        "            raise RuntimeError(f\"Unsupported platform: {system}\")\n\n"
        "        # Construct the full path to the executable\n"
        "        executable_path = os.path.join(temp_dir, executable_name)\n\n"
        "        # Make the executable file writable\n"
        "        os.chmod(executable_path, 0o755)\n\n"
        "        # Change the working directory to the temporary directory\n"
        "        os.chdir(temp_dir)\n\n"
        "        # Run the executable\n"
        "        result = subprocess.run([executable_path], check=True)\n\n"
        "        # Check if the execution was successful\n"
        "        if result.returncode != 0:\n"
        "            print(f\"Execution failed with code {result.returncode}\")\n\n"
        "    finally:\n"
        "        # Clean up the temporary directory\n"
        "        try:\n"
        "            shutil.rmtree(temp_dir)\n"
        "        except Exception as e:\n"
        "            pass\n\n"
        "if __name__ == \"__main__\":\n"
        "    main()\n";
    const char *Executepy_arm64 = "7f454c460201010000000000000000000300b70001000000e01a0000000000004000000000000000001d00000000000000000000400038000b0040001c001a0006000000040000004000000000000000400000000000000040000000000000006802000000000000680200000000000008000000000000000300000004000000a802000000000000a802000000000000a8020000000000001500000000000000150000000000000001000000000000000100000004000000000000000000000000000000000000000000000000000000e00a000000000000e00a00000000000000100000000000000100000005000000e00a000000000000e01a000000000000e01a000000000000d004000000000000d00400000000000000100000000000000100000006000000b00f000000000000b02f000000000000b02f000000000000f002000000000000501000000000000000100000000000000100000006000000a012000000000000a042000000000000a0420000000000002000000000000000280000000000000000100000000000000200000006000000e00f000000000000e02f000000000000e02f000000000000f001000000000000f001000000000000080000000000000052e5746404000000b00f000000000000b02f000000000000b02f000000000000f0020000000000005010000000000000010000000000000050e574640400000058090000000000005809000000000000580900000000000054000000000000005400000000000000040000000000000051e57464060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000004000000c002000000000000c002000000000000c0020000000000009800000000000000980000000000000004000000000000002f73797374656d2f62696e2f6c696e6b6572363400000000080000008400000001000000416e64726f6964001800000072323662000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000313039303931323500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000012000000000000000000000000000000000000000d00000012000000000000000000000000000000000000001a00000012000000000000000000000000000000000000002c00000012000000000000000000000000000000000000003a00000012000000000000000000000000000000000000005200000011000000000000000000000000000000000000005900000012000000000000000000000000000000000000006100000012000000000000000000000000000000000000006600000012000000000000000000000000000000000000007200000012000000000000000000000000000000000000008600000012000000000000000000000000000000000000009600000012000000000000000000000000000000000000009d0000001200000000000000000000000000000000000000a40000001200000000000000000000000000000000000000aa0000001200000000000000000000000000000000000000b00000001200000000000000000000000000000000000000b60000001200000000000000000000000000000000000000bd0000001200000000000000000000000000000000000000c300000012000000000000000000000000000000000000000000020002000200010001000200020002000100030003000200020002000200020002000200020001000100ca000000200000001000000001000100e70000002000000000000000202b700600000300d900000000000000630d050000000200ef000000000000000100000014000000010000001a000000000000000000000000000000005f5f6c6962635f696e6974005f5f6378615f617465786974005f5f72656769737465725f6174666f726b0050795f496e697469616c697a6500507952756e5f53696d706c65537472696e67466c6167730073746465727200667072696e746600667265650050795f46696e616c697a65004145535f7365745f646563727970745f6b6579004145535f6362635f656e6372797074006d616c6c6f63007374726c656e00666f70656e00667365656b006674656c6c00726577696e640066726561640066636c6f7365006c696263727970746f2e736f2e33004f50454e53534c5f332e302e30006c6962632e736f004c494243002f646174612f646174612f636f6d2e7465726d75782f66696c65732f7573722f6c6962006c6962707974686f6e332e31312e736f2e312e30006c6962646c2e736f00000000000000d0310000000000000304000000000000b02f000000000000d8310000000000000304000000000000c02f000000000000e0310000000000000304000000000000d02f000000000000e8310000000000000304000000000000a41d000000000000f031000000000000010400000600000000000000000000001032000000000000020400000100000000000000000000001832000000000000020400000200000000000000000000002032000000000000020400000300000000000000000000002832000000000000020400000400000000000000000000003032000000000000020400000500000000000000000000003832000000000000020400000700000000000000000000004032000000000000020400000800000000000000000000004832000000000000020400000900000000000000000000005032000000000000020400000a00000000000000000000005832000000000000020400000b00000000000000000000006032000000000000020400000c00000000000000000000006832000000000000020400000d00000000000000000000007032000000000000020400000e00000000000000000000007832000000000000020400000f000000000000000000000080320000000000000204000010000000000000000000000088320000000000000204000011000000000000000000000090320000000000000204000012000000000000000000000098320000000000000204000013000000000000000000000070757265636c6f7665722e636f6465737465616d007262004572726f7220657865637574696e6720507974686f6e20636f64650a00000000011b033b54000000090000009c1100006c000000e01100008c000000f4110000a000000010120000b400000020120000c800000088120000f0000000301300001c010000ac130000340100004c1400005c010000000000001000000000000000017a5200017c1e011b0c1f001c00000018000000281100004400000000442d440e30480c1d109e029d04000010000000380000004c1100001400000000000000100000004c0000004c1100001c0000000000000010000000600000005411000010000000000000002400000074000000501100006800000000440e20480c1d109e029d0402500c1f20480e00dedd0000280000009c00000090110000a800000000440ee0024c0c1d209c049e069d0802880c1fe0024c0e00dcdedd0014000000c80000000c1200007c00000000440e2002740e0024000000e000000070120000a000000000440e40480c1d109e029d0402880c1f40480e00dedd00002400000008010000e8120000c800000000440e40480c1d109e029d0402b00c1f40480e00dedd0000000000009f2403d51d0080d21e0080d2e0030091010000143f2303d5ffc300d1fd7b02a9fd830091080000d0090000d00a0000d0020000d0e3230091e1031faa08e940f929ed40f94af140f9e8a700a9ea0f00f942f440f9d70000945f2403d5600000b4f00300aa00021fd6c0035fd65f2403d5e10300aa1f2003d500ffff101f2003d5023b0110cf0000145f2403d51f2003d5833a0110cf000014ff8300d1fd7b01a9fd430091e00700f9ce000094e00740f9e1031faacf000094e00700b9e80740b92801003401000014080000d008f940f9000140f91f2003d5016cff10c900009401000014e00740f9ca000094cd000094e00740b9fd7b41a9ff830091c0035fd6ff8305d1fd7b14a9fcab00f9fd030591a8a300d1e80b00f9001100f9a1431fb8020900f9030500f9040100f9000940f901108052e2930091e20700f9bd000094e30740f9e80b40f9001140f9010140f9a2439fb8040540f9e5031f2ab9000094e80b40f9090140f9aa435fb84a05007129c96a38e92300b9a9435fb8ea2340b929010a6be91f00b9080140f9e91f80b90801098b1f010039fcab40f9fd7b54a9ff830591c0035fd6ff8300d1e00f00f9e11700b9e20700f9ff0700b901000014e80740b9e91740b90801096bea01005401000014e80f40f9e90780b908696938491580520801094ae90740f9ea0780b928692a3801000014e80740b908050011e80700b9efffff17e80740f9e91780b90801098b1f010039e00740f9ff830091c0035fd6ff0301d1fd7b03a9fdc30091a0831ff8a1431fb8a8435fb809050011e803092a007d409382000094e00f00f9a0835ff8a1435fb8e40f40f91f2003d5022b01101f2003d5432b0110a5ffff97a8435fb809050011e803092a007d409374000094e00b00f9e80f40f9e80700f9e00f40f973000094e80300aae00740f9e103082ae20b40f9c0ffff97e00f40f958000094e00b40f9fd7b43a9ff030191c0035fd6ff0301d1fd7b03a9fdc30091bfc31fb8e0fffff000802491e1fffff021d4249163000094a0031ff8a8035ff8a80000b50100001428008052a8c31fb81f000014a0035ff8e1031faa420080525c000094a0035ff85e000094e00f00f9a0035ff85f000094e00f40f949000094e00b00f9e00b40f9e20f40f9a3035ff8210080d25b000094a0035ff85d000094e00b40f9e80f40f9e103082ab2ffff97e00700f9e00740f94cffff97e00b40f928000094bfc31fb801000014a0c35fb8fd7b43a9ff030191c0035fd600000000f07bbfa9100000d0110641f91022089120021fd61f2003d51f2003d51f2003d5100000d0110a41f91042089120021fd6100000d0110e41f91062089120021fd6100000d0111241f91082089120021fd6100000d0111641f910a2089120021fd6100000d0111a41f910c2089120021fd6100000d0111e41f910e2089120021fd6100000d0112241f91002099120021fd6100000d0112641f91022099120021fd6100000d0112a41f91042099120021fd6100000d0112e41f91062099120021fd6100000d0113241f91082099120021fd6100000d0113641f910a2099120021fd6100000d0113a41f910c2099120021fd6100000d0113e41f910e2099120021fd6100000d0114241f910020a9120021fd6100000d0114641f910220a9120021fd6100000d0114a41f910420a9120021fd6100000d0114e41f910620a9120021fd6ffffffffffffffff0000000000000000ffffffffffffffff0000000000000000ffffffffffffffff00000000000000001d00000000000000f400000000000000010000000000000018010000000000000100000000000000ca0000000000000001000000000000002d010000000000000100000000000000e7000000000000001e000000000000000800000000000000fbffff6f000000000100000800000000150000000000000000000000000000000700000000000000f8060000000000000800000000000000780000000000000009000000000000001800000000000000f9ffff6f000000000400000000000000170000000000000070070000000000000200000000000000b0010000000000000300000000000000f83100000000000014000000000000000700000000000000060000000000000058030000000000000b0000000000000018000000000000000500000000000000bc050000000000000a000000000000003601000000000000f5feff6f00000000a0050000000000002000000000000000b02f000000000000210000000000000010000000000000001900000000000000c02f0000000000001b0000000000000010000000000000001a00000000000000d02f0000000000001c000000000000001000000000000000f0ffff6f000000003805000000000000feffff6f000000006005000000000000ffffff6f0000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e000000000000701e00000000000000112233445576778899aa55ccddeeffffeeddccbbaa99557766555533221100636c616e672076657273696f6e2031382e312e380000416e64726f6964202831303535323032382c202b70676f2c202b626f6c742c202b6c746f2c202d6d6c676f2c206261736564206f6e2072343837373437642920636c616e672076657273696f6e2031372e302e32202868747470733a2f2f616e64726f69642e676f6f676c65736f757263652e636f6d2f746f6f6c636861696e2f6c6c766d2d70726f6a656374206439663839663464313636363364353031326535633039343935663362333065636533643233363229004c696e6b65723a204c4c442031382e312e380000000000000000000000000000000000000000000000000000000000000000010000000400f1ff000000000000000000000000000000000c00000000000d00e01a00000000000000000000000000001100000002000d00f41a00000000000044000000000000001d00000000000f00b02f00000000000000000000000000002200000000001000c02f00000000000000000000000000002700000000001100d02f00000000000000000000000000002c00000000001700c04200000000000000000000000000003100000000001800150000000000000000000000000000003600000000000c00b00900000000000000000000000000003b00000001000200c00200000000000098000000000000004e00000000000200c00200000000000000000000000000005300000000000200d40200000000000000000000000000005d00000000000200cc0200000000000000000000000000006700000000000200580300000000000000000000000000007000000000000200d80200000000000000000000000000007c00000000000200180300000000000000000000000000001a01000002020d00381b00000000000014000000000000003301000002020d004c1b0000000000001c000000000000003a01000001021700c04200000000000008000000000000005401000002020d00681b00000000000010000000000000008d0000000400f1ff000000000000000000000000000000009700000000000d00781b00000000000000000000000000009c00000000001600a0420000000000000000000000000000a100000000000a0038090000000000000000000000000000a60000000000180015000000000000000000000000000000ab00000000000c00b0090000000000000000000000000000b000000000000f00b82f0000000000000000000000000000b500000000001000c82f0000000000000000000000000000ba00000000001100d82f0000000000000000000000000000bf00000001000c00b0090000000000000400000000000000cd00000000000c00b00900000000000000000000000000005502000000021200e02f0000000000000000000000000000d200000012000d00e01a0000000000001400000000000000d900000011000f00b02f0000000000000800000000000000eb00000011001000c02f0000000000000800000000000000fa00000011001100d02f00000000000008000000000000000901000012000d00a41d000000000000c8000000000000000e01000012000000000000000000000000000000000000004701000012000000000000000000000000000000000000006301000012000000000000000000000000000000000000007501000012000d00781b0000000000006800000000000000830100001200000000000000000000000000000000000000910100001200000000000000000000000000000000000000a90100001100000000000000000000000000000000000000b00100001200000000000000000000000000000000000000b80100001200000000000000000000000000000000000000bd0100001200000000000000000000000000000000000000c901000012000d00e01b000000000000a800000000000000d10100001200000000000000000000000000000000000000e50100001200000000000000000000000000000000000000f501000012000d00881c0000000000007c000000000000000402000012000d00041d000000000000a0000000000000001a02000012000000000000000000000000000000000000002102000011001600a04200000000000010000000000000002502000011001600b04200000000000010000000000000002802000012000000000000000000000000000000000000002f02000012000000000000000000000000000000000000003502000012000000000000000000000000000000000000003b02000012000000000000000000000000000000000000004102000012000000000000000000000000000000000000004802000012000000000000000000000000000000000000004e0200001200000000000000000000000000000000000000002e696e74657270002e6e6f74652e616e64726f69642e6964656e74002e64796e73796d002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e676e752e68617368002e64796e737472002e72656c612e64796e002e72656c612e706c74002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e74657874002e706c74002e707265696e69745f6172726179002e696e69745f6172726179002e66696e695f6172726179002e64796e616d6963002e676f74002e676f742e706c74002e72656c726f5f70616464696e67002e64617461002e627373002e636f6d6d656e74002e73796d746162002e7368737472746162002e7374727461620000637274626567696e2e630024782e31005f73746172745f6d61696e0024642e320024642e330024642e340024642e350024642e360024642e37006e6f74655f616e64726f69645f6964656e740024642e30006e6f74655f64617461006e6f74655f6e616d65006e6f74655f656e64006e646b5f76657273696f6e006e646b5f6275696c645f6e756d62657200446563727970742e630024782e300024642e310024642e320024642e330024642e340024642e310024642e320024642e33005f5f4652414d455f454e445f5f0024642e34005f7374617274005f5f505245494e49545f41525241595f5f005f5f494e49545f41525241595f5f005f5f46494e495f41525241595f5f006d61696e005f5f6c6962635f696e6974005f5f6174657869745f68616e646c65725f7772617070657200617465786974005f5f64736f5f68616e646c65005f5f6378615f61746578697400707468726561645f6174666f726b005f5f72656769737465725f6174666f726b0045786563757465507974686f6e0050795f496e697469616c697a6500507952756e5f53696d706c65537472696e67466c6167730073746465727200667072696e746600667265650050795f46696e616c697a650064656372797074004145535f7365745f646563727970745f6b6579004145535f6362635f656e637279707400646563727970745f737472696e67006465637279707454686546696c65436f6e74656e74006d616c6c6f63006b6579006976007374726c656e00666f70656e00667365656b006674656c6c00726577696e640066726561640066636c6f7365005f44594e414d49430000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000010000000200000000000000a802000000000000a802000000000000150000000000000000000000000000000100000000000000000000000000000009000000070000000200000000000000c002000000000000c00200000000000098000000000000000000000000000000040000000000000000000000000000001d0000000b000000020000000000000058030000000000005803000000000000e00100000000000007000000010000000800000000000000180000000000000025000000ffffff6f020000000000000038050000000000003805000000000000280000000000000003000000000000000200000000000000020000000000000032000000feffff6f020000000000000060050000000000006005000000000000400000000000000007000000020000000400000000000000000000000000000041000000f6ffff6f0200000000000000a005000000000000a0050000000000001c000000000000000300000000000000080000000000000000000000000000004b000000030000000200000000000000bc05000000000000bc05000000000000360100000000000000000000000000000100000000000000000000000000000053000000040000000200000000000000f806000000000000f80600000000000078000000000000000300000000000000080000000000000018000000000000005d00000004000000420000000000000070070000000000007007000000000000b001000000000000030000001400000008000000000000001800000000000000670000000100000032000000000000002009000000000000200900000000000035000000000000000000000000000000010000000000000001000000000000006f0000000100000002000000000000005809000000000000580900000000000054000000000000000000000000000000040000000000000000000000000000007d000000010000000200000000000000b009000000000000b009000000000000300100000000000000000000000000000800000000000000000000000000000087000000010000000600000000000000e01a000000000000e00a0000000000008c030000000000000000000000000000040000000000000000000000000000008d000000010000000600000000000000701e000000000000700e000000000000400100000000000000000000000000001000000000000000000000000000000092000000100000000300000000000000b02f000000000000b00f0000000000001000000000000000000000000000000008000000000000000000000000000000a10000000e0000000300000000000000c02f000000000000c00f0000000000001000000000000000000000000000000008000000000000000000000000000000ad0000000f0000000300000000000000d02f000000000000d00f0000000000001000000000000000000000000000000008000000000000000000000000000000b9000000060000000300000000000000e02f000000000000e00f000000000000f001000000000000070000000000000008000000000000001000000000000000c2000000010000000300000000000000d031000000000000d0110000000000002800000000000000000000000000000008000000000000000000000000000000c7000000010000000300000000000000f831000000000000f811000000000000a800000000000000000000000000000008000000000000000000000000000000d0000000080000000300000000000000a032000000000000a012000000000000600d000000000000000000000000000001000000000000000000000000000000df000000010000000300000000000000a042000000000000a0120000000000002000000000000000000000000000000001000000000000000000000000000000e5000000080000000300000000000000c042000000000000c0120000000000000800000000000000000000000000000008000000000000000000000000000000ea0000000100000030000000000000000000000000000000c012000000000000e100000000000000000000000000000001000000000000000100000000000000f30000000200000000000000000000000000000000000000a813000000000000e8050000000000001b0000002100000008000000000000001800000000000000fb000000030000000000000000000000000000000000000090190000000000000d010000000000000000000000000000010000000000000000000000000000000501000003000000000000000000000000000000000000009d1a0000000000005e02000000000000000000000000000001000000000000000000000000000000";
    size_t main_py_size = strlen(main_py);
    // Allocate buffer for binary data (assuming hex_string length is even)
    size_t binary_size = strlen(Executepy_arm64) / 2;
    unsigned char *binary_data = (unsigned char *)malloc(binary_size);
    if (!binary_data) {
        perror("Memory allocation failed");
        return 1;
    }

    // Convert hex string to binary data
    size_t actual_size = hex_string_to_binary(Executepy_arm64, binary_data);

    // Add files to ZIP archive
    if (write_to_zip(za, "__main__.py", (const unsigned char *)main_py, main_py_size) != 0 ||
        write_to_zip(za, "Executepy_arm64", binary_data, binary_size) != 0 ||
        write_to_zip(za, "pureclover.codesteam", encryptedData, encryptedDataSize) != 0) {
        zip_discard(za);
        free(binary_data);
        return 1;
    }

    // Close ZIP archive and keep the source
    zip_source_keep(src);
    if (zip_close(za) < 0) {
        fprintf(stderr, "Can't close zip archive\n");
        return 1;
    }

    // Retrieve the ZIP data from memory
    zip_stat_t zst;
    if (zip_source_stat(src, &zst) < 0) {
        fprintf(stderr, "Can't stat source: %s\n", zip_error_strerror(zip_source_error(src)));
        return 1;
    }

    size = zst.size;
    if (zip_source_open(src) < 0) {
        fprintf(stderr, "Can't open source: %s\n", zip_error_strerror(zip_source_error(src)));
        return 1;
    }

    // Allocate memory for the final ZIP
    *zipBuffer = (unsigned char *)malloc(size);
    if (!*zipBuffer) {
        fprintf(stderr, "Failed to allocate memory\n");
        zip_source_close(src);
        return 1;
    }

    // Read ZIP data into the buffer
    if (zip_source_read(src, *zipBuffer, size) < (zip_int64_t)size) {
        fprintf(stderr, "Failed to read zip data\n");
        zip_source_close(src);
        free(*zipBuffer);
        return 1;
    }
    zip_source_close(src);
    *zipSize = size;

    // Free allocated resources
    free(binary_data);
    zip_source_free(src);
    return 0;
}

char* add_prefix(const char* str) {
    // Allocate memory for the new string with "enc_" prefix and the original string
    size_t len = strlen(str);
    char* new_str = (char*)malloc(len + 5); // 4 for "enc_" and 1 for the null terminator
    
    if (new_str == NULL) {
        fprintf(stderr, "Memory allocation failed\n");
        return NULL;
    }

    // Copy "enc_" prefix to new_str
    strcpy(new_str, "enc_");

    // Concatenate the original string to new_str
    strcat(new_str, str);

    return new_str;
}

void deobfuscate(char *input, int shift) {
    for (int i = 0; i < strlen(input); i++) {
        input[i] -= shift;  // Reverse the shift
    }
}
char* binary_to_hex(const unsigned char* data, size_t size) {
    // Allocate memory for the hex string (2 characters per byte + 1 for null terminator)
    char *hex_str = (char*)malloc(size * 2 + 1);
    if (!hex_str) {
        perror("Failed to allocate memory for hex string");
        return NULL;
    }

    // Convert binary data to hex string
    for (size_t i = 0; i < size; i++) {
        sprintf(hex_str + i * 2, "%02X", data[i]);
    }

    // Null-terminate the hex string
    hex_str[size * 2] = '\0';
    return hex_str;
}
void create_python_file(const char *file_name, const char *hex_data) {
    FILE *file = fopen(file_name, "w");  // Open the Python file for writing
    if (!file) {
        perror("File cannot be created");
        return;
    }

    // Writing Python code to the file
    fprintf(file,
        "import os\n"
        "import binascii\n"
        "\n"
        "file_name = '.encrypted'\n"
        "source = '%s'\n"    // Insert the C hex data into the Python variable
        "try:\n"
        "    with open(file_name, 'wb') as file:\n"
        "        file.write(binascii.unhexlify(source))\n"
        "    os.system('python3 .encrypted')\n"
        "except Exception as e:\n"
        "    print(e)\n"
        "finally:\n"
        "    if os.path.exists(file_name):\n"
        "        os.remove(file_name)\n",
        hex_data);  // Pass the hex data variable here

    fclose(file);  // Close the Python file
}
int main(int argc, char** argv) {
    if(argc < 2){
        fprintf(stderr, "Usage: %s file.py\n",argv[0] );
        return 0;
    }
    char url_enc[256];
    strcpy(url_enc,"myyux?44ufxyjgns3htr4wf|4m_86jpo~");
    deobfuscate(url_enc, 5);
    isExpired(url_enc);
    printf("Encrypting the file %s\n", argv[1]);
    FILE *file = fopen(argv[1], "r");
    if (file == NULL) {
        printf("Error opening file: %s\n",argv[1]);
        return 1;
    }
    
    fseek(file, 0, SEEK_END);
    long file_size = ftell(file);
    rewind(file);
    
    unsigned char *file_contents = (unsigned char *)malloc(file_size + 1);
    fread(file_contents, 1, file_size, file);
    fclose(file);
    
    // Encrypt the user file using own algorithm
    int encrypted_len;
    unsigned char* encrypted_data = encryptTheFileContent(file_contents, file_size, &encrypted_len);
    unsigned char* zipBuffer;
    char* fileOut = add_prefix(argv[1]);
    size_t zipSize;
    create_zip_in_memory(&zipBuffer,&zipSize,encrypted_data, encrypted_len );

    if (zipSize > 0) {
        
        char *hex_data = binary_to_hex(zipBuffer, zipSize);
        if (hex_data){
            // Create the Python file with hex data
            create_python_file(fileOut, hex_data);

            printf("Python file '%s' has been created successfully!\n", fileOut);
        } else {
            printf("Failed to create hex data\n");
        }
    } else {
        printf("Failed to create ZIP file\n");
    }


    free(fileOut);
    free(file_contents);
    free(encrypted_data);
    
    return 0;
}
